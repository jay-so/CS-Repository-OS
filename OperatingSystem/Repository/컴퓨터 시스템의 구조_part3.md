# 🧑🏻‍🎨 컴퓨터 시스템의 구조

---

- 컴퓨터 내부: CPU, Memory
- 컴퓨터 외부: I/O 장치
- 컴퓨터 전원을 키면, 운영체제가 메모리에 올라가서 전원이 끝날때까지 있음

![1.png](..%2FImage%2F%EC%BB%B4%ED%93%A8%ED%84%B0%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98%20%EA%B5%AC%EC%A1%B0_part3%2F1.png)


- Device Controller: 각 외부 I/O를 관리하는 컨트롤러
- Local Buffer: 각 외부 I/O의 작업 공간
- Memory Controller: 메모리를 관리하는 컨트롤러
- CPU
  - 운영체제에서 있는 기계어를 실행할 때
  -> 필요한 기계어를 미리 정의해서 믿고 CPU를 실행함


  - 사용자 프로그램의 기계어를 실행할때
  -> 사용자 프로그램의 기계어를 실행할 때, CPU 작동에 오류가 생길 수도 있음
  -> 운영체제는 CPU가 프로그램을 실행할 때, 아무런 행동을 할 수 없음

-> 구분될 필요가 있음
-> **Mode Bit**으로 구분함

![2.png](..%2FImage%2F%EC%BB%B4%ED%93%A8%ED%84%B0%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98%20%EA%B5%AC%EC%A1%B0_part3%2F2.png)


## 🔎 Mode Bit이란?

---

- 사용자 프로그램의 잘못된 수행으로 다른 프로그램 및 운영체제에 피해가 가지 않도록 하기 위한 보호 장치가 필요함
- Mode Bit을 통해 하드웨어적으로 두가지 모드의 Operation을 지원함
  - **1: 사용자 모드**
  - 사용자의 프로그램을 수행함
  -> CPU 작업의 기계어는 보안을 해치지 않는 것만 실행되어야 함


  - **0: 모니터 모드**
  - 운영체제의 프로그램을 실행함
  -> CPU의 작업의 기계어는 어떤 것이 실행되어도 됨


- 보안을 해칠 수 있는 중요한 명령어는 모니터 모드에서만 수행이 가능한 "특권 명령(위험한 작업)"으로 규정함
**-> 운영체제에게 해당 내용이 넘어감(인터럽트, 예외할동)**

- 인터럽트나, 예외 발생 시, 하드웨어가 Mode Bit를 0으로 바꿈
- 작업을 처리한 후, 사용자 프로그램에게 CPU를 넘기기 전에 **Mode Bit을 1로 세팅하여 넘김**

**-> 오류가 발생할 수 있는 기계어를 Mode Bit이 0일때만 실행하도록 함으로써, 시스템을 보호하게 함**

![3.png](..%2FImage%2F%EC%BB%B4%ED%93%A8%ED%84%B0%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98%20%EA%B5%AC%EC%A1%B0_part3%2F3.png)


###  🔎  사용자 프로그램이 실행될 때 
- 기계어가 CPU에서 실행되기 전, 특권 명령인지 CPU가 판단한 후, **Mode Bit이 0이 아닐 경우에 해당 내역은 운영체제에게 넘어감**

**-> 이후, 운영체제게 해당 내역들을 처리함** 

- Interrupte Line(인터럽트 라인)
  - 매 순간 메모리에서 기계어를 읽어 실행한 후, 다음 기계어를 실행하기에 앞서 혹시 인터럽트 라인에 시그널이 있는지 체크함
  - 인터럽트 라인은 I/O 장치 컨트롤러가 시그널을 기록함


예시
- 한 프로그램이 디스크의 내역을 읽을 필요가 있을 때, 해당 내역을 모두 처리한 후 운영체제에게 알려줘야 함으로 일하고 있는 CPU에게 인터럽트를 발생하고, 다음 기계어가 실행되기 전 인터럽트 라인을 확인하여 CPU의 작업은 운영체제에게 넘어감

-> Mode Bit이 0이되고, 해당 인터럽트에 해당하는 일을 수행함
-> 읽어온 내용이 모두 완료되어 운영체제는 사용자에게 해당 내역으 ㄹ보여주는 작업을 처리함


- CPU안에는 레지스터가 존재함
  - CPU의 연산을 저장함
  - 레지스터 안에는 PC(Program Count)라는 레지스터가 존재함
  **- 프로그램 카운터 레지스터는 메모리 주소를 저장하며, 다음번에 실행할 기계어의 메모리의 주소를 가지고 있음**


- PC가 운영체제를 가리키고 있다면?

-> 다음은 운영체제가 실행되어야 함을 의미함

- PC가 사용자 프로그램 A를 가리키고 있다면?

-> 다음은 사용자 프로그램 A가 실행되어야 함을 의미함


- 타이머(Timer)
  - 정해진 시간이 흐른 뒤, 운영체제에게 제어권이 넘어가도록 인터럽트를 발생시킴
  
  -> 만약 무한 루프를 도는 프로그램이 있어 실행될 때, CPU의 제어권을 운영체제에게 넘김
  
  - 타이머는 매 클럭 틱 때마다 1씩 감소함
  - 타이머는 값이 0이 되면 타이머 인터럽트를 발생시킴
  - CPU를 특정 프로그램이 독점하는 것으로부터 보호함

- 타이머는 Time Sharing구현하기 위해 널리 이용됨
- 타이머는 현재 시간을 계산하기 위해서도 사용됨

![4.png](..%2FImage%2F%EC%BB%B4%ED%93%A8%ED%84%B0%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%98%20%EA%B5%AC%EC%A1%B0_part3%2F4.png)

<br/>

## 📖 Reference

---

[KOCW 반효경 교수님 - 운영제체](http://www.kocw.net/home/cview.do?cid=4b9cd4c7178db077)

[운영체제와 정보기술의 원리 - 반효경 교수님](https://www.aladin.co.kr/shop/wproduct.aspx?ISBN=K762639583&start=pnaver_02)